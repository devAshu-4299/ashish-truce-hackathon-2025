(()=>{function e(e,t=null){console.log(`[ConsentLens] ${e}`,t||"")}function t(){e(" Scanning for cookie banners...");const t=['[class*="cookie"]','[class*="consent"]','[id*="cookie"]','[id*="consent"]','[class*="gdpr"]','[id*="gdpr"]'];e("Using selectors:",t);let n=!1;for(const c of t)document.querySelectorAll(c).forEach((t=>{s(t)&&!t.classList.contains("consentlens-processed")&&(e(" Found cookie banner:",{selector:c,text:t.innerText.substring(0,100)+"...",element:t}),i(t,"cookie"),t.classList.add("consentlens-processed"),n=!0,chrome.runtime.sendMessage({type:"COOKIE_BANNER_DETECTED",data:{url:window.location.href,text:t.innerText,timestamp:(new Date).toISOString(),hasAcceptAll:o(t,"accept"),hasRejectAll:o(t,"reject"),hasCustomize:o(t,"customize"),status:!0}},(t=>{e(" Background script response:",t)})))}));n||e(" No cookie banners found on this page")}function n(){e(" Scanning for privacy policies...");const t=['a[href*="privacy"]','a[href*="datenschutz"]','a[href*="gdpr"]','[class*="privacy-policy"]'];e("Using selectors:",t);let n=!1;for(const o of t)document.querySelectorAll(o).forEach((t=>{s(t)&&!t.classList.contains("consentlens-processed")&&(e(" Found privacy policy:",{selector:o,text:t.innerText,href:t.href,element:t}),i(t,"policy"),t.classList.add("consentlens-processed"),n=!0,chrome.runtime.sendMessage({type:"PRIVACY_POLICY_DETECTED",data:{url:t.href||window.location.href,text:t.innerText,timestamp:(new Date).toISOString(),status:!0}},(t=>{e(" Background script response:",t)})))}));n||e(" No privacy policies found on this page")}function s(t){const n=window.getComputedStyle(t),s="none"!==n.display&&"hidden"!==n.visibility&&"0"!==n.opacity;return e("Visibility check for element:",{element:t,visible:s,display:n.display,visibility:n.visibility,opacity:n.opacity}),s}function o(t,n){const s="accept"===n?/accept|allow|agree|ok|yes/i:"reject"===n?/reject|decline|deny|no/i:/customize|settings|preferences|more/i,o=Array.from(t.querySelectorAll("button, a")).some((e=>s.test(e.innerText.toLowerCase())));return e(`Button check for ${n}:`,{element:t,hasButton:o,pattern:s.toString()}),o}function i(t,n){e(` Highlighting ${n} element:`,t),t.classList.add("consentlens-highlight");const s=document.createElement("div");s.className="consentlens-badge",s.textContent="",t.appendChild(s);const o=document.createElement("div");o.className="consentlens-tooltip",o.textContent="cookie"===n?"Cookie Banner Detected":"Privacy Policy Detected",t.appendChild(o)}chrome.runtime.onMessage.addListener(((e,t,n)=>{if("AUTH_STATE_CHANGE"===e.type&&e.session){const t=Object.keys(localStorage).filter((e=>e.startsWith("sb-")));t.forEach((e=>localStorage.removeItem(e)));const n="sb-"+new URL("https://byeezbrgqtvytbijlsob.supabase.co").hostname;localStorage.setItem(n,JSON.stringify({currentSession:e.session,expiresAt:Math.floor((Date.now()+36e5)/1e3)})),localStorage.setItem("supabase.auth.token",JSON.stringify(e.session)),window.location.reload()}})),e(" ConsentLens initialized"),t(),n(),e(" Setting up mutation observer"),new MutationObserver((()=>{e(" DOM changed, re-scanning..."),t(),n()})).observe(document.body,{childList:!0,subtree:!0})})();